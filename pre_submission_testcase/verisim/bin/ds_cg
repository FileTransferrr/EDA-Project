#!/bin/bash  
# 
# **************************************************************************************
# * NOTICE OF COPYRIGHT AND OWNERSHIP OF SOFTWARE:
# *
# * Copyright (c) 2010-2023 Primarius Technologies Co., Ltd.  All Rights Reserved.
# *
# * This computer program is the property of Primarius Technologies Co., Ltd. 9/F,
# * Building 4, No.26 Qiuyue Road, Zhangjiang, Pudong District, Shanghai, China
# * 
# * Any use, copy, publication, distribution, display, modification, or transmission
# * of this computer program in whole or in part in any form or by any means without
# * the prior express written permission of Primarius Technologies Co., Ltd. is
# * strictly prohibited.
# *
# * Except when expressly provided by Primarius Technologies Co., Ltd. in writing,
# * possession of this computer program shall not be construed to confer any license
# * or rights under any of Primarius Technologies Co., Ltd.'s intellectual property
# * rights, whether by estoppel, implication, or otherwise.
# *
# * ALL COPIES OF THIS PROGRAM MUST DISPLAY THIS NOTICE OF COPYRIGHT AND OWNERSHIP IN FULL.
# *****************************************************************************************
#
# Script to invoke VeriSim and associated tools. 
#

# unlimit stack to prevent segmentfault
ulimit -s unlimited

ECHO=/bin/echo

PRODUCT_BIT=64bit
FLASH_RELEASE=Release_64
SCRIPT_DIR=$(dirname "$0")
#export PATH=/usr/bin:/bin:${PATH}

if [[ -d "${SCRIPT_DIR}" && "${SCRIPT_DIR}" != "." ]];  then
    PRODUCT_BIN_PATH=${SCRIPT_DIR}
else
    PRODUCT_BIN_PATH=${PWD}
fi

VERISIM_TOP_DIR=$(dirname "${PRODUCT_BIN_PATH}")
export DSIM_HOME=${VERISIM_TOP_DIR}/simulator

LLVM_HOME=${DSIM_HOME}/llvm_small
STD_LIBS=${DSIM_HOME}/std_pkgs/lib

ARCH_NUM=$(/usr/bin/lsb_release -sr)

if [[ $ARCH_NUM =~ 5.* || $ARCH_NUM == 5 ]]; then
    $ECHO "Error, unsupported OS version!"
    exit -1
fi

PRODUCT_LIBRARY_PATH=${DSIM_HOME}/lib:${DSIM_HOME}/gcc/lib64:${DSIM_HOME}/gcc/lib:${LLVM_HOME}/lib
PRODUCT_VERISIM_BIN=${DSIM_HOME}/bin/ds_cg

export PATH=${DSIM_HOME}/gcc/bin:${DSIM_HOME}/binutils/bin:${DSIM_HOME}/mold/bin:${DSIM_HOME}/lz4:${DSIM_HOME}/bin:${LLVM_HOME}/bin:${PATH}

if [ -n "${LD_LIBRARY_PATH}" ]; then
    export LD_LIBRARY_PATH=${PRODUCT_LIBRARY_PATH}:${LD_LIBRARY_PATH}
else
    export LD_LIBRARY_PATH=${PRODUCT_LIBRARY_PATH}
fi

export TCL_LIBRARY=${DSIM_HOME}/lib

exec ${PRODUCT_VERISIM_BIN} "$@"

exit $status

